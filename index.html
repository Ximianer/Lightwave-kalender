<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightwave ERP Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        body { background-color: #020617; color: white; margin: 0; font-family: sans-serif; }
        #error-display { color: #f87171; padding: 20px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="error-display"></div>

    <script type="text/babel">
        // Fehler-Tracker für das Handy
        window.onerror = function(msg, url, line) {
            document.getElementById('error-display').innerHTML += `<p>FEHLER: ${msg} (Zeile: ${line})</p>`;
        };

        try {
            const { useState, useEffect } = React;
            const { Zap, LogOut, MapPin, ChevronRight } = lucide;

            const firebaseConfig = {
              apiKey: "AIzaSyBex_tBXXmG3yvutD98xOBY1SSGi-C4QFw",
              authDomain: "lightwave---terminkalender.firebaseapp.com",
              projectId: "lightwave---terminkalender",
              storageBucket: "lightwave---terminkalender.firebasestorage.app",
              messagingSenderId: "607834391470",
              appId: "1:607834391470:web:09d0bf801021b53aa67e3f"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();

            function App() {
                const [isLoggedIn, setIsLoggedIn] = useState(false);
                const [events, setEvents] = useState([]);
                const [loading, setLoading] = useState(true);

                useEffect(() => {
                    auth.signInAnonymously().then(() => {
                        // Greift direkt auf die Sammlung 'events' zu
                        return db.collection('events').onSnapshot(s => {
                            setEvents(s.docs.map(d => ({ id: d.id, ...d.data() })));
                            setLoading(false);
                        }, err => {
                            document.getElementById('error-display').innerHTML += `<p>DB-FEHLER: ${err.message}</p>`;
                        });
                    }).catch(e => {
                        document.getElementById('error-display').innerHTML += `<p>AUTH-FEHLER: ${e.message}</p>`;
                    });
                }, []);

                if (loading) return <div className="h-screen flex items-center justify-center font-bold animate-pulse uppercase italic tracking-tighter text-2xl">Lade Lightwave...</div>;

                if (!isLoggedIn) return (
                    <div className="h-screen flex items-center justify-center p-6">
                        <div className="bg-slate-900 p-8 rounded-[2rem] border border-slate-800 w-full max-w-sm text-center shadow-2xl">
                            <Zap className="text-indigo-500 mx-auto mb-4" size={48} />
                            <h1 className="text-2xl font-black mb-6 uppercase">Lightwave ERP</h1>
                            <button 
                                onClick={() => setIsLoggedIn(true)}
                                className="w-full bg-indigo-600 py-4 rounded-2xl font-bold uppercase tracking-widest active:scale-95 transition-all"
                            >
                                Login Bestätigen
                            </button>
                        </div>
                    </div>
                );

                return (
                    <div className="min-h-screen bg-slate-50 text-slate-900">
                        <nav className="bg-white border-b p-4 flex justify-between items-center sticky top-0">
                            <div className="flex items-center gap-2">
                                <Zap className="text-indigo-600" />
                                <span className="font-black uppercase tracking-tighter">Lightwave</span>
                            </div>
                            <button onClick={() => setIsLoggedIn(false)}><LogOut className="text-slate-400" /></button>
                        </nav>
                        <main className="p-6 max-w-xl mx-auto">
                            <h2 className="text-3xl font-black uppercase italic mb-6">Zeitplan</h2>
                            <div className="space-y-4">
                                {events.length > 0 ? events.map(ev => (
                                    <div key={ev.id} className="bg-white p-5 rounded-3xl border shadow-sm flex justify-between items-center">
                                        <div>
                                            <p className="font-black uppercase text-lg">{ev.title || 'Event'}</p>
                                            <p className="text-slate-400 text-xs flex items-center gap-1"><MapPin size={10}/> {ev.location || 'Kein Ort'}</p>
                                        </div>
                                        <ChevronRight className="text-indigo-600" />
                                    </div>
                                )) : (
                                    <div className="text-center py-10 text-slate-300 border-2 border-dashed rounded-[2rem] font-bold uppercase">
                                        Keine Termine gefunden
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                );
            }

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
            setTimeout(() => { if(window.lucide) window.lucide.createIcons(); }, 1000);

        } catch (e) {
            document.getElementById('error-display').innerHTML = `START-FEHLER: ${e.message}`;
        }
    </script>
</body>
</html>
